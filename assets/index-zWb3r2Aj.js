import*as n from"https://cdn.jsdelivr.net/npm/d3@7/+esm";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))p(a);new MutationObserver(a=>{for(const t of a)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&p(o)}).observe(document,{childList:!0,subtree:!0});function h(a){const t={};return a.integrity&&(t.integrity=a.integrity),a.referrerPolicy&&(t.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?t.credentials="include":a.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function p(a){if(a.ep)return;a.ep=!0;const t=h(a);fetch(a.href,t)}})();const P=()=>{let l,m,h,p,a,t,o,i,c,s,r;function b(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}const u=e=>{const v=t==="string"?n.scalePoint().domain(h.map(p)).range([i.left,l-i.right]):n.scaleLinear().domain(n.extent(h,p)).range([i.left,l-i.right]),g=o==="string"?n.scalePoint().domain(h.map(a)).range([m-i.bottom,i.top]):n.scaleLinear().domain(n.extent(h,a)).range([m-i.bottom,i.top]),C=n.scaleOrdinal().domain(n.range(h.length)).range(r),N=n.transition().duration(1e3),L=n.transition().duration(2e3),d=y=>{y.attr("cx",w=>v(p(w))).attr("cy",w=>g(a(w)))},T=y=>{y.attr("r",0)},x=y=>{y.transition(L).attr("r",c)};n.select("body > div.tooltip").remove();const f=n.select("body").append("div").attr("class","tooltip").style("opacity",0);e.selectAll("circle").data(h).join(y=>y.append("circle").attr("fill",(w,M)=>C(M)).call(d).call(T).call(x),y=>y.call(w=>w.transition(N).delay((M,I)=>I*1).call(d)),y=>y.remove()).on("mouseover",function(y,w){f.transition().duration(100).style("opacity",.9),f.html(s.map(M=>`${b(M)}: ${w[M]}`).join(`
`)).style("position","absolute").style("left",y.pageX+"px").style("top",y.pageY-28+"px")}).on("mouseout",function(y){f.transition().duration(500).style("opacity",0)}),e.selectAll(".y-axis").data([null]).join("g").attr("class","y-axis").attr("transform",`translate(${i.left},0)`).transition(N).call(n.axisLeft(g)),e.selectAll(".x-axis").data([null]).join("g").attr("class","x-axis").attr("transform",`translate(0,${m-i.bottom})`).transition(N).call(n.axisBottom(v)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)")};return u.width=function(e){return arguments.length?(l=+e,u):l},u.height=function(e){return arguments.length?(m=+e,u):m},u.data=function(e){return arguments.length?(h=e,u):h},u.xValue=function(e){return arguments.length?(p=e,u):p},u.yValue=function(e){return arguments.length?(a=e,u):a},u.xType=function(e){return arguments.length?(t=e,u):t},u.yType=function(e){return arguments.length?(o=e,u):o},u.margin=function(e){return arguments.length?(i=e,u):i},u.radius=function(e){return arguments.length?(c=e,u):c},u.tooltipTexts=function(e){return arguments.length?(s=e,u):s},u.colorScheme=function(e){return arguments.length?(r=e,u):r},u},k=()=>{let l,m,h;const p=n.dispatch("change");let a=0;const t=o=>{o.selectAll("label").data([null]).join("label").attr("for",l).text(m),o.selectAll("select").data([null]).join("select").attr("id",l).on("change",i=>{p.call("change",null,i.target.value)}).selectAll("option").data(h).join("option").attr("value",i=>i.value).text(i=>i.text).property("selected",(i,c)=>c===a)};return t.id=function(o){return arguments.length?(l=o,t):l},t.labelText=function(o){return arguments.length?(m=o,t):m},t.options=function(o){return arguments.length?(h=o,t):h},t.on=function(){let o=p.on.apply(p,arguments);return o===p?t:o},t.defaultOption=function(o){return arguments.length?(a=o,t):a},t},{csv:U}=n,F="/vgsales.csv",A=900,j=600,V={top:50,right:20,bottom:140,left:140},$=l=>l.Year,z=l=>l.Global_Sales;function W(){n.select(".menu-container").remove(),n.select(".graphic-container").remove(),n.select(".tooltip").remove(),n.select(".reset-button").remove(),n.select(".chart-title").remove();const l=n.select("#app").append("div").attr("class","menu-container"),m=l.append("div").attr("class","menu"),h=l.append("div").attr("class","menu"),p=c=>(c.Rank=+c.Rank,c.Year=+c.Year,c.EU_Sales=+c.EU_Sales,c.Global_Sales=+c.Global_Sales,c);n.select("#chart").append("h2").attr("class","chart-title").text("Nintendo Games Sales");const a=n.select("#chart").append("svg").attr("width",A).attr("height",j).attr("class","graphic-container");let t;document.body.classList.contains("light-mode")?t=n.schemePastel1:t=n.schemeCategory10,(async()=>{let c=await U(F,p);c=c.filter(e=>e.Publisher==="Nintendo"&&Number(e.Year));const s=P().width(A).height(j).data(c).xValue($).yValue(z).margin(V).tooltipTexts(["Name"]).radius(5).colorScheme(t);a.call(s);const r=[{value:"Year",text:"Year",type:"number"},{value:"Global_Sales",text:"Global Sales",type:"number"},{value:"EU_Sales",text:"EU Sales",type:"number"},{value:"Rank",text:"Rank",type:"number"},{value:"Genre",text:"Genre",type:"string"}],b=e=>r.find(g=>g.value===e).type;h.call(k().id("x-menu").labelText("X:").options(r).on("change",e=>{a.call(s.xValue(v=>v[e]).xType(b(e)))})),m.call(k().id("y-menu").labelText("Y:").options(r).on("change",e=>{a.call(s.yValue(v=>v[e]).yType(b(e)))}).defaultOption(1)),window.addEventListener("themeChange",function(e){e.detail.lightMode?t=n.schemePastel1:t=n.schemeCategory10,u()});function u(){const e=P().width(A).height(j).data(c).xValue($).yValue(z).margin(V).tooltipTexts(["Name"]).radius(5).colorScheme(t);a.selectAll("*").remove(),a.call(e),a.selectAll("circle").style("fill",function(v,g){return t[g%t.length]})}})()}const O=()=>{let l,m,h;const p=n.dispatch("change");let a;const t=o=>{if(a==="select")o.selectAll("select").data([null]).join("select").attr("id",l).on("change",i=>{p.call("change",null,i.target.value)}).selectAll("option").data(h).join("option").attr("value",i=>i.value).text(i=>i.text);else if(a==="radio"){let i=o.selectAll("div.radio").data(h).join("div").attr("class","radio").attr("id",c=>`${l}-${c.value}`);i.append("input").attr("type","radio").attr("id",c=>c.value).attr("name",l).attr("value",c=>c.value).property("checked",(c,s)=>s===0).on("change",c=>{p.call("change",null,c.target.value)}),i.append("label").attr("for",c=>c.value).text(c=>c.value)}};return t.id=function(o){return arguments.length?(l=o,t):l},t.labelText=function(o){return arguments.length?(m=o,t):m},t.options=function(o){return arguments.length?(h=o,t):h},t.on=function(){let o=p.on.apply(p,arguments);return o===p?t:o},t.menuType=function(o){return arguments.length?(a=o,t):a},t},X=()=>{let l,m,h,p,a,t,o,i;function c(r){return r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()}const s=r=>{let b=n.geoMercator().translate(p).scale(a);const u=n.geoPath().projection(b),e=n.scaleLog().domain([1,n.max(h,g=>g[i])]).interpolate(()=>n.interpolateRdPu);r.select("path").remove(),r.selectAll("g.container").append("path").datum(topojson.mesh(l,m)).attr("fill","none").attr("stroke","#ccc").attr("d",u),n.select("body > div.tooltip").remove();const v=n.select("body").append("div").attr("class","tooltip").style("opacity",0);r.select("g.circle").remove(),r.selectAll("g.container").append("g").attr("class","circle").selectAll("circle").data(h).enter().append("circle").attr("cx",function(g){return b([g.lon,g.lat])[0]}).attr("cy",function(g){return b([g.lon,g.lat])[1]}).attr("r",t).style("fill",g=>e(g[i])).attr("opacity",0).on("mouseover",function(g,C){v.transition().duration(100).style("opacity",.9),v.html(o.map(N=>`${c(N)}: ${C[N]}`).join(`
`)).style("position","absolute").style("left",g.pageX+"px").style("top",g.pageY-28+"px")}).on("mouseout",function(g){v.transition().duration(500).style("opacity",0)}).transition().delay((g,C)=>C*30).duration(1e3).attr("opacity",1)};return s.dataMap=function(r){return arguments.length?(l=r,s):l},s.dataMapDetails=function(r){return arguments.length?(m=r,s):m},s.dataMarks=function(r){return arguments.length?(h=r,s):h},s.translation=function(r){return arguments.length?(p=r,s):p},s.scale=function(r){return arguments.length?(a=r,s):a},s.radius=function(r){return arguments.length?(t=r,s):t},s.tooltipTexts=function(r){return arguments.length?(o=r,s):o},s.propertyColor=function(r){return arguments.length?(i=r,s):i},s},{csv:q,json:B}=n,R=window.innerWidth,Y=window.innerHeight*.65,H="/trials.csv";let E=1,D=()=>{};function K(){n.select(".menu-container").remove(),n.select(".graphic-container").remove(),n.select(".chart-title").remove();const l=n.select("body").append("div").attr("class","menu-container"),m=l.append("div").attr("class","radio-menu"),h=l.append("div").attr("class","select-menu"),p=n.zoom().scaleExtent([1,8]).on("zoom",o);n.select("#chart").append("h2").attr("class","chart-title").text("Trials for Witchcraft in Europe (1400-1900)");const a=n.select("#chart").append("svg").attr("viewBox",[0,0,R,Y]).attr("width",R).attr("height",Y).attr("class","graphic-container").attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("style","max-width: 100%; height: auto;").call(p),t=a.append("g").attr("class","container");function o(s){s.transform.k!==E&&(E=s.transform.k,D({}));const{transform:r}=s;t.attr("transform",r)}a.call(n.drag().filter(s=>!s.button).on("drag",i));function i(s){const r=n.zoomTransform(a.node()),b=r.x+s.dx,u=r.y+s.dy;a.call(p.transform,n.zoomIdentity.translate(b,u).scale(r.k))}n.select("button.reset-button").remove(),n.select(".menu-container").append("button").attr("class","reset-button").text("Reset position").on("click",()=>{a.transition().duration(750).call(p.transform,n.zoomIdentity)}),(async()=>{const r=(await q(H)).filter(d=>(!isNaN(Number(d.deaths))&&+d.deaths!=0||!isNaN(Number(d.tried))&&+d.tried!=0)&&!isNaN(Number(d.lon))&&!isNaN(Number(d.lat))&&+d.lon>=-90&&+d.lon<=90&&+d.lat>=-180&&+d.lat<=180);let b="1400",u="deaths",e=["1400","1500","1600","1700","1800","1900"],v={};e.forEach(d=>{let T=r.filter(x=>x.century===d);if(T.length===0){e=e.filter(x=>x!==d);return}v[d]=T.reduce((x,f)=>{x.totalDeaths+=+isNaN(f.deaths)?0:+f.deaths,x.totalTried+=+isNaN(f.tried)?0:+f.tried;const y=x.details.findIndex(w=>w.city===f.city);if(y>-1){const w=x.details[y];w.deaths+=+isNaN(f.deaths)?0:+f.deaths,w.tried+=+isNaN(f.tried)?0:+f.tried,x.details[y]=w}else x.details.push({lon:+f.lon,lat:+f.lat,deaths:+isNaN(f.deaths)?0:+f.deaths,tried:+isNaN(f.tried)?0:+f.tried,city:f.city});return x},{totalDeaths:0,totalTried:0,details:[]})});let g=v[b].details.filter(d=>!isNaN(Number(d[u]))&&d[u]!==0);const C=await B("/europe.topojson"),N=X().translation([window.innerWidth/2-100,960]).scale(530).dataMap(C).dataMapDetails(C.objects.europe).dataMarks(g).radius(5).tooltipTexts(["city",u]).propertyColor(u);a.call(N);const L=({century:d=b,type:T=u})=>{let x=v[d].details.filter(f=>!isNaN(Number(f[T]))&&f[T]!==0);a.call(N.radius(5/E).dataMarks(x).propertyColor(T).tooltipTexts(["city",T]))};D=L,m.call(O().id("century-menu").labelText("Century").menuType("radio").options(e.map(d=>({value:d,text:d}))).on("change",d=>{b=d,L({century:d})})),h.call(O().id("color-menu").labelText("Data").menuType("select").options([{value:"deaths",text:"Deaths"},{value:"tried",text:"Tried"}]).on("change",d=>{u=d,L({type:d})}))})()}const S={"/":W,"/map":K};window.onhashchange=function(){const l=window.location.hash.substring(1);S[l]?S[l]():console.log("Ruta no encontrada")};if(window.location.hash){const l=window.location.hash.substring(1);S[l]&&S[l]()}else S["/"]();function G(){document.querySelectorAll(".menuItems a").forEach(m=>{m.getAttribute("href")===window.location.hash?m.classList.add("active"):m.classList.remove("active")})}G();window.addEventListener("hashchange",G);const _=document.querySelector(".switch__input");_.checked=!0;_.addEventListener("change",function(){this.checked?document.body.classList.remove("light-mode"):document.body.classList.add("light-mode");const l=new CustomEvent("themeChange",{detail:{lightMode:document.body.classList.contains("light-mode")}});window.dispatchEvent(l)});
